(function(){"use strict";var e={8602:function(e,i,t){var a=t(5130),s=t(6768),n=t(4232);const r={id:"app"},l={class:"controls"},o=["value"],h={for:"grid-gap-slider"},d=["href"],g={key:0,class:"loading-overlay"};function c(e,i,t,c,u,p){const m=(0,s.g2)("GridCell");return(0,s.uX)(),(0,s.CE)("div",r,[i[7]||(i[7]=(0,s.Lk)("h1",null,"Photo Grid Collage",-1)),(0,s.Lk)("div",l,[(0,s.Lk)("input",{type:"file",multiple:"",accept:"image/*",onChange:i[0]||(i[0]=(...e)=>p.handleFileUpload&&p.handleFileUpload(...e))},null,32),i[5]||(i[5]=(0,s.Lk)("label",{for:"grid-size"},"选择网格大小：",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":i[1]||(i[1]=e=>u.gridSize=e),onChange:i[2]||(i[2]=(...e)=>p.generateGrid&&p.generateGrid(...e))},[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(9,(e=>(0,s.Lk)("option",{key:e+1,value:e+1},(0,n.v_)(e+1)+" x "+(0,n.v_)(e+1),9,o))),64))],544),[[a.u1,u.gridSize]]),(0,s.Lk)("label",h,"调整网格间距："+(0,n.v_)(u.gridGap)+"px",1),(0,s.bo)((0,s.Lk)("input",{id:"grid-gap-slider",type:"range",min:"0",max:"20","onUpdate:modelValue":i[3]||(i[3]=e=>u.gridGap=e)},null,512),[[a.Jo,u.gridGap]]),(0,s.Lk)("button",{onClick:i[4]||(i[4]=(...e)=>p.exportImage&&p.exportImage(...e))},"导出为 JPEG"),u.exportedImage?((0,s.uX)(),(0,s.CE)("a",{key:0,href:u.exportedImage,download:"collage.jpg"},"下载图片",8,d)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",{class:"grid-container",style:(0,n.Tr)(p.gridStyle),ref:"gridContainer"},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(u.gridCells,((e,i)=>((0,s.uX)(),(0,s.Wv)(m,{key:e.id,image:e.image,onUpdateImage:e=>p.updateCellImage(i,e)},null,8,["image","onUpdateImage"])))),128))],4),u.isLoading?((0,s.uX)(),(0,s.CE)("div",g,i[6]||(i[6]=[(0,s.Lk)("div",{class:"spinner"},null,-1)]))):(0,s.Q3)("",!0)])}t(4114),t(8992),t(3949);const u={class:"grid-cell",ref:"cell"},p=["src"],m={key:1,class:"placeholder"};function f(e,i,t,a,r,l){return(0,s.uX)(),(0,s.CE)("div",u,[t.image?((0,s.uX)(),(0,s.CE)("img",{key:0,src:t.image,class:"draggable",ref:"image",style:(0,n.Tr)(l.imageStyle)},null,12,p)):((0,s.uX)(),(0,s.CE)("div",m,"请上传图片"))],512)}var v=t(2506),x=t.n(v),y={props:{image:String},emits:["updateImage"],data(){return{scale:1,position:{x:0,y:0},imageNaturalWidth:0,imageNaturalHeight:0,cellWidth:0,cellHeight:0,initialScale:1}},computed:{imageStyle(){return{transform:`translate(${this.position.x}px, ${this.position.y}px) scale(${this.scale})`}}},mounted(){this.image&&(this.$nextTick((()=>{this.initializeImage()})),this.$refs.image&&this.$refs.image.addEventListener("wheel",this.onWheel))},beforeUnmount(){this.$refs.image&&this.$refs.image.removeEventListener("wheel",this.onWheel)},watch:{image(e){e&&this.$nextTick((()=>{this.initializeImage(),this.$refs.image&&this.$refs.image.addEventListener("wheel",this.onWheel)}))}},methods:{initializeImage(){this.position={x:0,y:0},this.scale=1;const e=new Image;e.onload=()=>{this.imageNaturalWidth=e.width,this.imageNaturalHeight=e.height,this.$nextTick((()=>{const e=this.$refs.cell.getBoundingClientRect();this.cellWidth=e.width,this.cellHeight=e.height;const i=this.cellWidth/this.imageNaturalWidth,t=this.cellHeight/this.imageNaturalHeight;this.initialScale=Math.max(i,t),this.scale=this.initialScale;const a=this.imageNaturalWidth*this.initialScale,s=this.imageNaturalHeight*this.initialScale;this.position.x=(this.cellWidth-a/this.scale)/2,this.position.y=(this.cellHeight-s/this.scale)/2,this.initInteract()}))},e.src=this.image},initInteract(){x()(this.$refs.image).draggable({modifiers:[x().modifiers.restrictRect({restriction:this.$refs.cell,endOnly:!0})],listeners:{move:e=>{this.position.x+=e.dx,this.position.y+=e.dy,e.target.style.transform=`translate(${this.position.x}px, ${this.position.y}px) scale(${this.scale})`}}}).gesturable({listeners:{move:e=>{this.scale*=1+e.ds,this.scale=Math.max(.05*this.initialScale,Math.min(this.scale,10*this.initialScale)),e.target.style.transform=`translate(${this.position.x}px, ${this.position.y}px) scale(${this.scale})`}}})},onWheel(e){e.preventDefault();const i=e.deltaY<0?.05:-.05,t=1+i,a=this.scale*t,s=.5*this.initialScale,n=3*this.initialScale;this.scale=Math.max(s,Math.min(a,n));const r=this.imageNaturalWidth/this.imageNaturalHeight,l=i,o=i*r;this.position.x-=l,this.position.y-=o,this.$refs.image.style.transform=`translate(${this.position.x}px, ${this.position.y}px) scale(${this.scale})`}}},C=t(1241);const $=(0,C.A)(y,[["render",f]]);var I=$,k=t(2125),b=t.n(k);const S={components:{GridCell:I},data(){return{gridSize:2,gridGap:10,gridCells:[],uploadedImages:[],exportedImage:null,isLoading:!1}},computed:{gridStyle(){return{"grid-template-columns":`repeat(${this.gridSize}, 1fr)`}}},methods:{generateGrid(){const e=this.gridSize*this.gridSize;this.gridCells=Array.from({length:e},((e,i)=>({id:i,image:null}))),this.uploadedImages=[],this.exportedImage=null},handleFileUpload(e){const i=Array.from(e.target.files),t=this.gridSize*this.gridSize,a=t-this.uploadedImages.length;i.length>a?alert(`您最多还能上传 ${a} 张图片`):(i.forEach((e=>{const i=new FileReader;i.onload=e=>{this.uploadedImages.push(e.target.result),this.placeImageInGrid(e.target.result)},i.readAsDataURL(e)})),e.target.value="")},placeImageInGrid(e){for(let i=0;i<this.gridCells.length;i++)if(!this.gridCells[i].image){this.gridCells[i].image=e;break}},updateCellImage(e,i){this.$set(this.gridCells,e,{...this.gridCells[e],image:i})},exportImage(){this.isLoading=!0,b()(this.$refs.gridContainer,{useCORS:!0,scale:3}).then((e=>{this.exportedImage=e.toDataURL("image/jpeg"),this.isLoading=!1})).catch((()=>{this.isLoading=!1,alert("导出失败，请重试。")}))}},mounted(){this.generateGrid()}},L=()=>{(0,a.$9)((e=>({fbacae44:e.gridGap+"px"})))},w=S.setup;S.setup=w?(e,i)=>(L(),w(e,i)):L;var E=S;const G=(0,C.A)(E,[["render",c]]);var W=G;(0,a.Ef)(W).mount("#app")}},i={};function t(a){var s=i[a];if(void 0!==s)return s.exports;var n=i[a]={id:a,loaded:!1,exports:{}};return e[a].call(n.exports,n,n.exports,t),n.loaded=!0,n.exports}t.m=e,function(){var e=[];t.O=function(i,a,s,n){if(!a){var r=1/0;for(d=0;d<e.length;d++){a=e[d][0],s=e[d][1],n=e[d][2];for(var l=!0,o=0;o<a.length;o++)(!1&n||r>=n)&&Object.keys(t.O).every((function(e){return t.O[e](a[o])}))?a.splice(o--,1):(l=!1,n<r&&(r=n));if(l){e.splice(d--,1);var h=s();void 0!==h&&(i=h)}}return i}n=n||0;for(var d=e.length;d>0&&e[d-1][2]>n;d--)e[d]=e[d-1];e[d]=[a,s,n]}}(),function(){t.n=function(e){var i=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(i,{a:i}),i}}(),function(){t.d=function(e,i){for(var a in i)t.o(i,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:i[a]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,i){return Object.prototype.hasOwnProperty.call(e,i)}}(),function(){t.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={524:0};t.O.j=function(i){return 0===e[i]};var i=function(i,a){var s,n,r=a[0],l=a[1],o=a[2],h=0;if(r.some((function(i){return 0!==e[i]}))){for(s in l)t.o(l,s)&&(t.m[s]=l[s]);if(o)var d=o(t)}for(i&&i(a);h<r.length;h++)n=r[h],t.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return t.O(d)},a=self["webpackChunkphoto_grid_collage"]=self["webpackChunkphoto_grid_collage"]||[];a.forEach(i.bind(null,0)),a.push=i.bind(null,a.push.bind(a))}();var a=t.O(void 0,[504],(function(){return t(8602)}));a=t.O(a)})();
//# sourceMappingURL=app.02dac0e7.js.map