(function(){"use strict";var e={5420:function(e,t,i){var a=i(5130),s=i(6768),n=i(4232);const r={id:"app"},l={class:"controls"},o=["value"],h=["href"];function g(e,t,i,g,d,c){const u=(0,s.g2)("GridCell");return(0,s.uX)(),(0,s.CE)("div",r,[t[5]||(t[5]=(0,s.Lk)("h1",null,"Photo Grid Collage",-1)),(0,s.Lk)("div",l,[t[4]||(t[4]=(0,s.Lk)("label",{for:"grid-size"},"选择网格大小：",-1)),(0,s.bo)((0,s.Lk)("select",{"onUpdate:modelValue":t[0]||(t[0]=e=>d.gridSize=e),onChange:t[1]||(t[1]=(...e)=>c.generateGrid&&c.generateGrid(...e))},[((0,s.uX)(),(0,s.CE)(s.FK,null,(0,s.pI)(9,(e=>(0,s.Lk)("option",{key:e+1,value:e+1},(0,n.v_)(e+1)+" x "+(0,n.v_)(e+1),9,o))),64))],544),[[a.u1,d.gridSize]]),(0,s.Lk)("input",{type:"file",multiple:"",accept:"image/*",onChange:t[2]||(t[2]=(...e)=>c.handleFileUpload&&c.handleFileUpload(...e))},null,32),(0,s.Lk)("button",{onClick:t[3]||(t[3]=(...e)=>c.exportImage&&c.exportImage(...e))},"导出为 JPEG"),d.exportedImage?((0,s.uX)(),(0,s.CE)("a",{key:0,href:d.exportedImage,download:"collage.jpg"},"下载图片",8,h)):(0,s.Q3)("",!0)]),(0,s.Lk)("div",{class:"grid-container",style:(0,n.Tr)(c.gridStyle),ref:"gridContainer"},[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(d.gridCells,((e,t)=>((0,s.uX)(),(0,s.Wv)(u,{key:e.id,image:e.image,onUpdateImage:e=>c.updateCellImage(t,e)},null,8,["image","onUpdateImage"])))),128))],4)])}i(4114),i(8992),i(3949);const d={class:"grid-cell",ref:"cell"},c=["src"],u={key:1,class:"placeholder"};function m(e,t,i,a,r,l){return(0,s.uX)(),(0,s.CE)("div",d,[i.image?((0,s.uX)(),(0,s.CE)("img",{key:0,src:i.image,class:"draggable",ref:"image",style:(0,n.Tr)(l.imageStyle)},null,12,c)):((0,s.uX)(),(0,s.CE)("div",u,"拖拽或点击添加图片"))],512)}var p=i(2506),f=i.n(p),v={props:{image:String},emits:["updateImage"],data(){return{scale:1,position:{x:0,y:0},imageNaturalWidth:0,imageNaturalHeight:0,cellWidth:0,cellHeight:0,initialScale:1}},computed:{imageStyle(){return{transform:`translate(${this.position.x}px, ${this.position.y}px) scale(${this.scale})`}}},mounted(){this.image&&(this.$nextTick((()=>{this.initializeImage()})),this.$refs.image&&this.$refs.image.addEventListener("wheel",this.onWheel))},beforeUnmount(){this.$refs.image&&this.$refs.image.removeEventListener("wheel",this.onWheel)},watch:{image(e){e&&this.$nextTick((()=>{this.initializeImage(),this.$refs.image&&this.$refs.image.addEventListener("wheel",this.onWheel)}))}},methods:{initializeImage(){this.position={x:0,y:0},this.scale=1;const e=new Image;e.onload=()=>{this.imageNaturalWidth=e.width,this.imageNaturalHeight=e.height,this.$nextTick((()=>{const e=this.$refs.cell.getBoundingClientRect();this.cellWidth=e.width,this.cellHeight=e.height;const t=this.cellWidth/this.imageNaturalWidth,i=this.cellHeight/this.imageNaturalHeight;this.initialScale=Math.max(t,i),this.scale=this.initialScale;const a=this.imageNaturalWidth*this.initialScale,s=this.imageNaturalHeight*this.initialScale;this.position.x=(this.cellWidth-a/this.scale)/2,this.position.y=(this.cellHeight-s/this.scale)/2,this.initInteract()}))},e.src=this.image},initInteract(){f()(this.$refs.image).draggable({modifiers:[f().modifiers.restrictRect({restriction:this.$refs.cell,endOnly:!0})],listeners:{move:e=>{this.position.x+=e.dx,this.position.y+=e.dy,e.target.style.transform=`translate(${this.position.x}px, ${this.position.y}px) scale(${this.scale})`}}}).gesturable({listeners:{move:e=>{this.scale*=1+e.ds,this.scale=Math.max(.05*this.initialScale,Math.min(this.scale,10*this.initialScale)),e.target.style.transform=`translate(${this.position.x}px, ${this.position.y}px) scale(${this.scale})`}}})},onWheel(e){e.preventDefault();const t=e.deltaY<0?.05:-.05,i=1+t,a=this.scale*i,s=.5*this.initialScale,n=3*this.initialScale;this.scale=Math.max(s,Math.min(a,n));const r=this.imageNaturalWidth/this.imageNaturalHeight,l=t,o=t*r;this.position.x-=l,this.position.y-=o,this.$refs.image.style.transform=`translate(${this.position.x}px, ${this.position.y}px) scale(${this.scale})`}}},x=i(1241);const y=(0,x.A)(v,[["render",m]]);var C=y,I=i(2125),$=i.n(I),k={components:{GridCell:C},data(){return{gridSize:2,gridCells:[],uploadedImages:[],exportedImage:null}},computed:{gridStyle(){return{"grid-template-columns":`repeat(${this.gridSize}, 1fr)`}}},methods:{generateGrid(){const e=this.gridSize*this.gridSize;this.gridCells=Array.from({length:e},((e,t)=>({id:t,image:null}))),this.uploadedImages=[],this.exportedImage=null},handleFileUpload(e){const t=Array.from(e.target.files),i=this.gridSize*this.gridSize,a=i-this.uploadedImages.length;t.length>a?alert(`您最多还能上传 ${a} 张图片`):(t.forEach((e=>{const t=new FileReader;t.onload=e=>{this.uploadedImages.push(e.target.result),this.placeImageInGrid(e.target.result)},t.readAsDataURL(e)})),e.target.value="")},placeImageInGrid(e){for(let t=0;t<this.gridCells.length;t++)if(!this.gridCells[t].image){this.gridCells[t].image=e;break}},updateCellImage(e,t){this.$set(this.gridCells,e,{...this.gridCells[e],image:t})},exportImage(){$()(this.$refs.gridContainer,{useCORS:!0}).then((e=>{this.exportedImage=e.toDataURL("image/jpeg")}))}},mounted(){this.generateGrid()}};const S=(0,x.A)(k,[["render",g]]);var b=S;(0,a.Ef)(b).mount("#app")}},t={};function i(a){var s=t[a];if(void 0!==s)return s.exports;var n=t[a]={id:a,loaded:!1,exports:{}};return e[a].call(n.exports,n,n.exports,i),n.loaded=!0,n.exports}i.m=e,function(){var e=[];i.O=function(t,a,s,n){if(!a){var r=1/0;for(g=0;g<e.length;g++){a=e[g][0],s=e[g][1],n=e[g][2];for(var l=!0,o=0;o<a.length;o++)(!1&n||r>=n)&&Object.keys(i.O).every((function(e){return i.O[e](a[o])}))?a.splice(o--,1):(l=!1,n<r&&(r=n));if(l){e.splice(g--,1);var h=s();void 0!==h&&(t=h)}}return t}n=n||0;for(var g=e.length;g>0&&e[g-1][2]>n;g--)e[g]=e[g-1];e[g]=[a,s,n]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){i.d=function(e,t){for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){i.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){var e={524:0};i.O.j=function(t){return 0===e[t]};var t=function(t,a){var s,n,r=a[0],l=a[1],o=a[2],h=0;if(r.some((function(t){return 0!==e[t]}))){for(s in l)i.o(l,s)&&(i.m[s]=l[s]);if(o)var g=o(i)}for(t&&t(a);h<r.length;h++)n=r[h],i.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return i.O(g)},a=self["webpackChunkphoto_grid_collage"]=self["webpackChunkphoto_grid_collage"]||[];a.forEach(t.bind(null,0)),a.push=t.bind(null,a.push.bind(a))}();var a=i.O(void 0,[504],(function(){return i(5420)}));a=i.O(a)})();
//# sourceMappingURL=app.3434e6e2.js.map